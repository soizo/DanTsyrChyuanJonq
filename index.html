<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Words">
    <meta name="theme-color" content="#F5F4F0" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1A1A1A" media="(prefers-color-scheme: dark)">
    <title>Dan Tsyr Chyuan Jonq</title>
    <link rel="preconnect" href="https://fontsapi.zeoseven.com" crossorigin>
    <link rel="stylesheet" href="https://fontsapi.zeoseven.com/214/main/result.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>
            <img src="assets/title.png" alt="Dan Tsyr Chyuan Jonq">
        </h1>

        <div class="workspace-layout" id="workspaceLayout">
            <div class="workspace-left">
                <!-- Mode Switch -->
                <div class="mode-switch">
                    <label>Show</label>
                    <div class="toggle" id="modeToggle" tabindex="0">
                        <div class="toggle-slider"></div>
                    </div>
                    <label>Hide Meaning</label>
                </div>

                <!-- Status Indicator -->
                <div class="status-indicator" id="statusIndicator"></div>

                <!-- Add Word Form -->
                <div class="add-form">
                    <div class="form-row">
                        <label>Word</label>
                        <input type="text" id="wordInput" required>
                    </div>
                    <div class="form-row">
                        <label>Meaning</label>
                        <input type="text" id="meaningInput">
                    </div>
                    <div class="form-grid-3">
                        <div class="form-row">
                            <label>POS</label>
                            <div class="dropdown-container pos-selector" id="posSelector">
                                <div class="dropdown-selected pos-selected" id="posSelected">
                                    <span class="pos-placeholder">Select...</span>
                                </div>
                                <div class="dropdown-menu pos-dropdown" id="posDropdown">
                                    <label class="dropdown-option pos-option" data-value="n" onclick="togglePosOption(this, event)">n.</label>
                                    <label class="dropdown-option pos-option" data-value="v" onclick="togglePosOption(this, event)">v.</label>
                                    <label class="dropdown-option pos-option" data-value="adj" onclick="togglePosOption(this, event)">adj.</label>
                                    <label class="dropdown-option pos-option" data-value="adv" onclick="togglePosOption(this, event)">adv.</label>
                                    <label class="dropdown-option pos-option" data-value="prep" onclick="togglePosOption(this, event)">prep.</label>
                                    <label class="dropdown-option pos-option" data-value="conj" onclick="togglePosOption(this, event)">conj.</label>
                                    <label class="dropdown-option pos-option" data-value="pron" onclick="togglePosOption(this, event)">pron.</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <label>Weight</label>
                            <div class="dropdown-container weight-selector" id="weightSelector">
                                <div class="dropdown-selected weight-selected" id="weightSelected">
                                    3
                                </div>
                                <div class="dropdown-menu weight-dropdown" id="weightDropdown">
                                    <label class="dropdown-option weight-option" data-value="5" onclick="setWeightOption(this, event)">5</label>
                                    <label class="dropdown-option weight-option" data-value="4" onclick="setWeightOption(this, event)">4</label>
                                    <label class="dropdown-option weight-option selected" data-value="3" onclick="setWeightOption(this, event)">3</label>
                                    <label class="dropdown-option weight-option" data-value="2" onclick="setWeightOption(this, event)">2</label>
                                    <label class="dropdown-option weight-option" data-value="1" onclick="setWeightOption(this, event)">1</label>
                                    <label class="dropdown-option weight-option" data-value="0" onclick="setWeightOption(this, event)">0</label>
                                    <label class="dropdown-option weight-option" data-value="-1" onclick="setWeightOption(this, event)">-1</label>
                                    <label class="dropdown-option weight-option" data-value="-2" onclick="setWeightOption(this, event)">-2</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <label>Date</label>
                            <input type="date" id="dateInput" class="range-input-date">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="addWord()">Add</button>
                </div>

                <!-- Data Controls -->
                <div class="data-controls">
                    <button class="btn-secondary" onclick="manualSave()">Save</button>
                    <button class="btn-secondary" onclick="exportData()">Export</button>
                    <button class="btn-secondary" onclick="document.getElementById('importFile').click()">Import</button>
                    <button class="btn-secondary" id="selectModeBtn" onclick="toggleSelectMode()">Select Words</button>
                    <button class="btn-secondary" id="sortModeBtn" onclick="toggleSortMode()">A-Z</button>
                    <button class="btn-secondary" onclick="openSettingsModal()">Settings</button>
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)">
                </div>

                <!-- Batch Operations Toolbar (hidden by default) -->
                <div id="batchToolbar" class="batch-toolbar">
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Select:</div>
                        <div class="batch-toolbar-controls">
                            <button class="btn-batch" onclick="selectAll()">All</button>
                            <button class="btn-batch" onclick="selectNone()">None</button>
                            <button class="btn-batch" onclick="selectInvert()">Invert</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Weight:</div>
                        <div class="batch-toolbar-controls">
                            <div class="range-input-group">
                                <input type="number" id="weightMinInput" class="range-input" value="-3" min="-3">
                                <span class="range-separator">~</span>
                                <input type="number" id="weightMaxInput" class="range-input" placeholder="∞">
                            </div>
                            <button class="btn-batch btn-batch-add" onclick="addWeightRange()">+</button>
                            <button class="btn-batch btn-batch-remove" onclick="removeWeightRange()">−</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Date:</div>
                        <div class="batch-toolbar-controls">
                            <div class="range-input-group">
                                <input type="date" id="dateMinInput" class="range-input range-input-date">
                                <span class="range-separator">~</span>
                                <input type="date" id="dateMaxInput" class="range-input range-input-date">
                            </div>
                            <button class="btn-batch btn-batch-add" onclick="addDateRange()">+</button>
                            <button class="btn-batch btn-batch-remove" onclick="removeDateRange()">−</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Regex:</div>
                        <div class="batch-toolbar-controls">
                            <input type="text" id="regexFilterInput" class="regex-input" placeholder="e.g. ^un.*ing$">
                            <button class="btn-batch btn-batch-add" onclick="selectByRegex()">+</button>
                            <button class="btn-batch btn-batch-remove" onclick="deselectByRegex()">−</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Actions:</div>
                        <div class="batch-toolbar-controls">
                            <button class="btn-batch btn-batch-up" onclick="batchAdjustWeight(1)" id="batchUpBtn" disabled>Up</button>
                            <button class="btn-batch btn-batch-down" onclick="batchAdjustWeight(-1)" id="batchDownBtn" disabled>Down</button>
                            <button class="btn-batch btn-batch-delete" onclick="batchDeleteConfirm()" id="batchDeleteBtn" disabled>Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            <div
                class="layout-divider"
                id="layoutDivider"
                role="separator"
                tabindex="0"
                aria-label="Adjust layout split"
                aria-orientation="vertical"
                aria-valuemin="0"
                aria-valuemax="100"
                aria-valuenow="50"
            ></div>

            <div class="workspace-right">
                <!-- Word List -->
                <div id="wordList"></div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Word</div>
            <div class="form-row">
                <label>Word</label>
                <input type="text" id="editWordInput">
            </div>
            <div class="form-row">
                <label>Meaning</label>
                <input type="text" id="editMeaningInput">
            </div>
            <div class="form-grid-3">
                <div class="form-row">
                    <label>POS</label>
                    <div class="dropdown-container pos-selector" id="editPosSelector">
                        <div class="dropdown-selected pos-selected" id="editPosSelected">
                            <span class="pos-placeholder">Select...</span>
                        </div>
                        <div class="dropdown-menu pos-dropdown" id="editPosDropdown">
                            <label class="dropdown-option pos-option" data-value="n" onclick="toggleEditPosOption(this, event)">n.</label>
                            <label class="dropdown-option pos-option" data-value="v" onclick="toggleEditPosOption(this, event)">v.</label>
                            <label class="dropdown-option pos-option" data-value="adj" onclick="toggleEditPosOption(this, event)">adj.</label>
                            <label class="dropdown-option pos-option" data-value="adv" onclick="toggleEditPosOption(this, event)">adv.</label>
                            <label class="dropdown-option pos-option" data-value="prep" onclick="toggleEditPosOption(this, event)">prep.</label>
                            <label class="dropdown-option pos-option" data-value="conj" onclick="toggleEditPosOption(this, event)">conj.</label>
                            <label class="dropdown-option pos-option" data-value="pron" onclick="toggleEditPosOption(this, event)">pron.</label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <label>Weight</label>
                    <div class="dropdown-container weight-selector" id="editWeightSelector">
                        <div class="dropdown-selected weight-selected" id="editWeightSelected">
                            3
                        </div>
                        <div class="dropdown-menu weight-dropdown" id="editWeightDropdown">
                            <label class="dropdown-option weight-option" data-value="5" onclick="setEditWeightOption(this, event)">5</label>
                            <label class="dropdown-option weight-option" data-value="4" onclick="setEditWeightOption(this, event)">4</label>
                            <label class="dropdown-option weight-option selected" data-value="3" onclick="setEditWeightOption(this, event)">3</label>
                            <label class="dropdown-option weight-option" data-value="2" onclick="setEditWeightOption(this, event)">2</label>
                            <label class="dropdown-option weight-option" data-value="1" onclick="setEditWeightOption(this, event)">1</label>
                            <label class="dropdown-option weight-option" data-value="0" onclick="setEditWeightOption(this, event)">0</label>
                            <label class="dropdown-option weight-option" data-value="-1" onclick="setEditWeightOption(this, event)">-1</label>
                            <label class="dropdown-option weight-option" data-value="-2" onclick="setEditWeightOption(this, event)">-2</label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <label>Date</label>
                    <input type="date" id="editDateInput">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-primary" onclick="saveEdit()">Save</button>
                <button class="btn-secondary" onclick="closeEditModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Settings</div>

            <div class="form-row">
                <label>Max Versions</label>
                <input type="number" id="maxVersionsInput" min="10" max="200" value="50">
            </div>

            <div class="form-row">
                <label>Export Options</label>
                <div style="display: flex; gap: 8px;">
                    <button class="btn-secondary" onclick="exportDataOnly()" style="margin-top: 0;">Data Only</button>
                    <button class="btn-secondary" onclick="exportWithVersionHistory()" style="margin-top: 0;">With Version History</button>
                </div>
            </div>

            <div class="form-row">
                <label>Version History</label>
                <button class="btn-secondary" onclick="openHistoryModal()" style="margin-top: 0;">View History</button>
            </div>

            <div class="modal-actions">
                <button class="btn-primary" onclick="saveSettings()">Save</button>
                <button class="btn-secondary" onclick="closeSettingsModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- History Modal (Registry Editor Style) -->
    <div id="historyModal" class="modal modal-registry">
        <div class="registry-container">
            <!-- Toolbar -->
            <div class="registry-toolbar">
                <div class="registry-title">Version History</div>
                <div class="registry-toolbar-actions">
                    <span id="registryVersionInfo" class="registry-info"></span>
                    <button class="registry-toolbar-btn" id="registryDeleteBtn" onclick="deleteSelectedVersions()" disabled title="Delete selected">Del</button>
                    <button class="registry-toolbar-btn" id="registryRenameBtn" onclick="renameSelectedVersion()" disabled title="Rename selected">Ren</button>
                    <button class="registry-close" onclick="closeHistoryModal()" aria-label="Close">&times;</button>
                </div>
            </div>

            <!-- Address bar -->
            <div class="registry-addressbar">
                <div id="registryPath" class="registry-path"></div>
            </div>

            <!-- Main body: tree + preview -->
            <div class="registry-body">
                <!-- Left pane: tree -->
                <div class="registry-tree-pane" id="registryTreePane">
                    <div id="historyTree" class="registry-tree">
                        <!-- Dynamically generated tree -->
                    </div>
                </div>

                <!-- Divider -->
                <div class="registry-divider"></div>

                <!-- Right pane: preview -->
                <div class="registry-preview-pane" id="registryPreviewPane">
                    <!-- Mode switcher (PC only) -->
                    <div class="registry-preview-tabs" id="registryPreviewTabs">
                        <button class="registry-tab active" data-mode="version" onclick="switchPreviewMode('version')">Version</button>
                        <button class="registry-tab" data-mode="diff" onclick="switchPreviewMode('diff')">Diff</button>
                    </div>
                    <div id="registryPreview" class="registry-preview">
                        <div class="registry-preview-empty">Select a version to preview</div>
                    </div>
                </div>
            </div>

            <!-- Mobile preview overlay (portrait) -->
            <div class="registry-mobile-preview" id="registryMobilePreview">
                <div class="registry-mobile-preview-header">
                    <button class="registry-back-btn" onclick="closeMobilePreview()">&lt; Back</button>
                    <span id="mobilePreviewTitle" class="registry-mobile-title"></span>
                    <button class="btn-secondary registry-goto-btn" id="mobileGotoBtn" onclick="">Go to</button>
                </div>
                <div id="mobilePreviewContent" class="registry-preview"></div>
            </div>

            <!-- Status bar -->
            <div class="registry-statusbar">
                <span id="registryStatusLeft"></span>
                <span id="registryStatusRight"></span>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
