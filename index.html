<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="icon" type="image/png" href="assets/icon.png">
    <link rel="apple-touch-icon" href="assets/webapp.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Words">
    <meta name="theme-color" content="#F5F4F0" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1A1A1A" media="(prefers-color-scheme: dark)">
    <title>Dan Tsyr Chyuan Jonq</title>
    <link rel="preconnect" href="https://fontsapi.zeoseven.com" crossorigin>
    <link rel="stylesheet" href="https://fontsapi.zeoseven.com/214/main/result.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>
            <img src="assets/title.png" alt="Dan Tsyr Chyuan Jonq">
        </h1>

        <div class="workspace-layout" id="workspaceLayout">
            <div class="workspace-left">
                <!-- Mode Switch -->
                <div class="mode-switch">
                    <label>Show</label>
                    <div class="toggle" id="modeToggle" tabindex="0">
                        <div class="toggle-slider"></div>
                    </div>
                    <label>Hide Meaning</label>
                </div>

                <!-- Status Indicator -->
                <div class="status-indicator" id="statusIndicator"></div>

                <!-- Add Word Form -->
                <div class="add-form">
                    <div class="form-row">
                        <label>Word</label>
                        <input type="text" id="wordInput" required>
                    </div>
                    <div class="form-row">
                        <label>Meaning</label>
                        <input type="text" id="meaningInput">
                    </div>
                    <div class="form-row">
                        <label>Tags</label>
                        <div class="dropdown-container tag-selector" id="tagSelector">
                            <div class="dropdown-selected tag-selected" id="tagSelected">
                                <span class="tag-placeholder">Tags</span>
                            </div>
                            <div class="dropdown-menu tag-dropdown" id="tagDropdown">
                                <div class="tag-input-row">
                                    <input type="text" id="tagNewInput" class="tag-new-input" placeholder="New tag…" autocomplete="off">
                                    <button class="tag-add-btn" onclick="addNewTagFromInput(event)">+</button>
                                </div>
                                <div id="tagOptionsList" class="tag-options-list"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-grid-3">
                        <div class="form-row">
                            <label>POS</label>
                            <div class="dropdown-container pos-selector" id="posSelector">
                                <div class="dropdown-selected pos-selected" id="posSelected">
                                    <span class="pos-placeholder">POS</span>
                                </div>
                                <div class="dropdown-menu pos-dropdown" id="posDropdown">
                                    <label class="dropdown-option pos-option" data-value="n" onclick="togglePosOption(this, event)">n.</label>
                                    <label class="dropdown-option pos-option" data-value="v" onclick="togglePosOption(this, event)">v.</label>
                                    <label class="dropdown-option pos-option" data-value="adj" onclick="togglePosOption(this, event)">adj.</label>
                                    <label class="dropdown-option pos-option" data-value="adv" onclick="togglePosOption(this, event)">adv.</label>
                                    <label class="dropdown-option pos-option" data-value="prep" onclick="togglePosOption(this, event)">prep.</label>
                                    <label class="dropdown-option pos-option" data-value="conj" onclick="togglePosOption(this, event)">conj.</label>
                                    <label class="dropdown-option pos-option" data-value="pron" onclick="togglePosOption(this, event)">pron.</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <label>Weight</label>
                            <div class="dropdown-container weight-selector" id="weightSelector">
                                <div class="dropdown-selected weight-selected" id="weightSelected">
                                    3
                                </div>
                                <div class="dropdown-menu weight-dropdown" id="weightDropdown">
                                    <label class="dropdown-option weight-option" data-value="5" onclick="setWeightOption(this, event)">5</label>
                                    <label class="dropdown-option weight-option" data-value="4" onclick="setWeightOption(this, event)">4</label>
                                    <label class="dropdown-option weight-option selected" data-value="3" onclick="setWeightOption(this, event)">3</label>
                                    <label class="dropdown-option weight-option" data-value="2" onclick="setWeightOption(this, event)">2</label>
                                    <label class="dropdown-option weight-option" data-value="1" onclick="setWeightOption(this, event)">1</label>
                                    <label class="dropdown-option weight-option" data-value="0" onclick="setWeightOption(this, event)">0</label>
                                    <label class="dropdown-option weight-option" data-value="-1" onclick="setWeightOption(this, event)">-1</label>
                                    <label class="dropdown-option weight-option" data-value="-2" onclick="setWeightOption(this, event)">-2</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <label>Date</label>
                            <input type="date" id="dateInput" class="range-input-date">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="addWord()">Add</button>
                </div>

                <!-- Data Controls -->
                <div class="data-controls">
                    <!-- <button class="btn-secondary" onclick="manualSave()">Save</button> -->
                    <button class="btn-secondary" onclick="exportData()">Export</button>
                    <button class="btn-secondary" onclick="document.getElementById('importFile').click()">Import</button>
                    <button class="btn-secondary" id="selectModeBtn" onclick="toggleSelectMode()">Select Words</button>
                    <button class="btn-secondary" id="sortModeBtn" onclick="toggleSortMode()">A-Z</button>
                    <button class="btn-secondary" id="groupModeBtn" onclick="toggleGroupMode()">By Weight</button>
                    <button class="btn-secondary" id="quizModeBtn" onclick="openQuizSetup()">Quiz</button>
                    <button class="btn-secondary" onclick="openSettingsModal()">Settings</button>
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)">
                </div>

                <!-- Tag Filter Bar -->
                <div class="tag-filter-bar" id="tagFilterBar"></div>

                <!-- Batch Operations Toolbar (hidden by default) -->
                <div id="batchToolbar" class="batch-toolbar">
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Select:</div>
                        <div class="batch-toolbar-controls">
                            <button class="btn-batch" onclick="selectAll()">All</button>
                            <button class="btn-batch" onclick="selectNone()">None</button>
                            <button class="btn-batch" onclick="selectInvert()">Invert</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Weight:</div>
                        <div class="batch-toolbar-controls">
                            <div class="range-input-group">
                                <input type="number" id="weightMinInput" class="range-input" value="3" min="-3">
                                <span class="range-separator">~</span>
                                <input type="number" id="weightMaxInput" class="range-input" placeholder="∞" min="-3">
                            </div>
                            <button class="btn-batch btn-batch-add" onclick="addWeightRange()">+</button>
                            <button class="btn-batch btn-batch-remove" onclick="removeWeightRange()">−</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Date:</div>
                        <div class="batch-toolbar-controls">
                            <div class="range-input-group">
                                <input type="date" id="dateMinInput" class="range-input-date">
                                <span class="range-separator">~</span>
                                <input type="date" id="dateMaxInput" class="range-input-date">
                            </div>
                            <button class="btn-batch btn-batch-add" onclick="addDateRange()">+</button>
                            <button class="btn-batch btn-batch-remove" onclick="removeDateRange()">−</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Regex:</div>
                        <div class="batch-toolbar-controls">
                            <input type="text" id="regexFilterInput" class="regex-input" placeholder="e.g. ^un.*ing$" oninput="validateRegexInput()">
                            <button class="btn-batch btn-batch-add" onclick="selectByRegex()">+</button>
                            <button class="btn-batch btn-batch-remove" onclick="deselectByRegex()">−</button>
                            <div id="regexSyntaxError" class="regex-syntax-error"></div>
                        </div>
                    </div>
                    <div class="batch-toolbar-section">
                        <div class="batch-toolbar-label">Tag:</div>
                        <div class="batch-toolbar-controls">
                            <div class="dropdown-container tag-selector batch-tag-selector" id="batchTagFilterSelector">
                                <div class="dropdown-selected tag-selected batch-tag-filter-selected" id="batchTagFilterSelected">
                                    <span class="tag-placeholder">Tag</span>
                                </div>
                                <div class="dropdown-menu tag-dropdown" id="batchTagFilterDropdown">
                                    <div id="batchTagFilterOptionsList" class="tag-options-list"></div>
                                </div>
                            </div>
                            <button class="btn-batch btn-batch-add" onclick="selectByTag()">+</button>
                            <button class="btn-batch btn-batch-remove" onclick="deselectByTag()">−</button>
                        </div>
                    </div>
                    <div class="batch-toolbar-section batch-toolbar-section-actions">
                        <div class="batch-toolbar-label">Actions:</div>
                        <div class="batch-toolbar-controls">
                            <button class="btn-batch btn-batch-up" onclick="batchAdjustWeight(1)" id="batchUpBtn" disabled>Up</button>
                            <button class="btn-batch btn-batch-down" onclick="batchAdjustWeight(-1)" id="batchDownBtn" disabled>Down</button>
                            <button class="btn-batch btn-batch-delete" onclick="batchDeleteConfirm()" id="batchDeleteBtn" disabled>Delete</button>
                            <div class="batch-actions-date-row">
                                <input type="date" id="batchDateInput" class="range-input-date batch-set-date-input">
                                <button class="btn-batch" onclick="batchSetDate()" id="batchSetDateBtn" disabled>Set Date</button>
                            </div>
                            <div class="batch-actions-date-row">
                                <div class="dropdown-container tag-selector batch-tag-selector" id="batchTagActionSelector" style="flex:1 1 0;min-width:0;">
                                    <div class="dropdown-selected tag-selected batch-tag-filter-selected" id="batchTagActionSelected">
                                        <span class="tag-placeholder">Tag</span>
                                    </div>
                                    <div class="dropdown-menu tag-dropdown" id="batchTagActionDropdown">
                                        <div class="tag-input-row">
                                            <input type="text" id="batchTagActionNewInput" class="tag-new-input" placeholder="New tag…" autocomplete="off">
                                            <button class="tag-add-btn" onclick="addBatchTagActionFromInput(event)">+</button>
                                        </div>
                                        <div id="batchTagActionOptionsList" class="tag-options-list"></div>
                                    </div>
                                </div>
                                <button class="btn-batch" onclick="batchAddTag()" id="batchAddTagBtn" disabled>+Tag</button>
                                <button class="btn-batch" onclick="batchRemoveTag()" id="batchRemoveTagBtn" disabled>−Tag</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div
                class="layout-divider"
                id="layoutDivider"
                role="separator"
                tabindex="0"
                aria-label="Adjust layout split"
                aria-orientation="vertical"
                aria-valuemin="0"
                aria-valuemax="100"
                aria-valuenow="50"
            ></div>

            <div class="workspace-right">
                <!-- Word List -->
                <div id="wordList"></div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Word</div>
            <div class="form-row">
                <label>Word</label>
                <input type="text" id="editWordInput">
            </div>
            <div class="form-row">
                <label>Meaning</label>
                <input type="text" id="editMeaningInput">
            </div>
            <div class="form-row">
                <label>Tags</label>
                <div class="dropdown-container tag-selector" id="editTagSelector">
                    <div class="dropdown-selected tag-selected" id="editTagSelected">
                        <span class="tag-placeholder">Tags</span>
                    </div>
                    <div class="dropdown-menu tag-dropdown" id="editTagDropdown">
                        <div class="tag-input-row">
                            <input type="text" id="editTagNewInput" class="tag-new-input" placeholder="New tag…" autocomplete="off">
                            <button class="tag-add-btn" onclick="addNewEditTagFromInput(event)">+</button>
                        </div>
                        <div id="editTagOptionsList" class="tag-options-list"></div>
                    </div>
                </div>
            </div>
            <div class="form-grid-3">
                <div class="form-row">
                    <label>POS</label>
                    <div class="dropdown-container pos-selector" id="editPosSelector">
                        <div class="dropdown-selected pos-selected" id="editPosSelected">
                            <span class="pos-placeholder">▽</span>
                        </div>
                        <div class="dropdown-menu pos-dropdown" id="editPosDropdown">
                            <label class="dropdown-option pos-option" data-value="n" onclick="toggleEditPosOption(this, event)">n.</label>
                            <label class="dropdown-option pos-option" data-value="v" onclick="toggleEditPosOption(this, event)">v.</label>
                            <label class="dropdown-option pos-option" data-value="adj" onclick="toggleEditPosOption(this, event)">adj.</label>
                            <label class="dropdown-option pos-option" data-value="adv" onclick="toggleEditPosOption(this, event)">adv.</label>
                            <label class="dropdown-option pos-option" data-value="prep" onclick="toggleEditPosOption(this, event)">prep.</label>
                            <label class="dropdown-option pos-option" data-value="conj" onclick="toggleEditPosOption(this, event)">conj.</label>
                            <label class="dropdown-option pos-option" data-value="pron" onclick="toggleEditPosOption(this, event)">pron.</label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <label>Weight</label>
                    <div class="dropdown-container weight-selector" id="editWeightSelector">
                        <div class="dropdown-selected weight-selected" id="editWeightSelected">
                            3
                        </div>
                        <div class="dropdown-menu weight-dropdown" id="editWeightDropdown">
                            <label class="dropdown-option weight-option" data-value="5" onclick="setEditWeightOption(this, event)">5</label>
                            <label class="dropdown-option weight-option" data-value="4" onclick="setEditWeightOption(this, event)">4</label>
                            <label class="dropdown-option weight-option selected" data-value="3" onclick="setEditWeightOption(this, event)">3</label>
                            <label class="dropdown-option weight-option" data-value="2" onclick="setEditWeightOption(this, event)">2</label>
                            <label class="dropdown-option weight-option" data-value="1" onclick="setEditWeightOption(this, event)">1</label>
                            <label class="dropdown-option weight-option" data-value="0" onclick="setEditWeightOption(this, event)">0</label>
                            <label class="dropdown-option weight-option" data-value="-1" onclick="setEditWeightOption(this, event)">-1</label>
                            <label class="dropdown-option weight-option" data-value="-2" onclick="setEditWeightOption(this, event)">-2</label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <label>Date</label>
                    <input type="date" id="editDateInput" class="range-input-date">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-primary" onclick="saveEdit()">Save</button>
                <button class="btn-secondary" onclick="closeEditModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Settings</div>

            <div class="form-row">
                <label>Profile ID</label>
                <input type="text" id="projectIdInput" autocomplete="off" spellcheck="false">
                <div class="settings-inline-actions">
                    <button class="btn-secondary" onclick="generateProjectIdForSettings()">Generate New ID</button>
                </div>
            </div>

            <div class="form-row">
                <label>Export Options</label>
                <div class="settings-inline-actions">
                    <button class="btn-secondary" onclick="exportDataOnly()">Data Only</button>
                    <button class="btn-secondary" onclick="exportWithVersionHistory()">With Version History</button>
                    <button class="btn-secondary" onclick="viewCurrentFullRawFile()">View Full Raw File</button>
                </div>
            </div>

            <div class="form-row">
                <label>Version History</label>
                <input type="number" id="maxVersionsInput" min="10" max="200" value="50">
                <div class="settings-inline-actions">
                    <button class="btn-secondary" id="openHistoryBtn" onclick="openHistoryModal()">View History</button>
                </div>
            </div>

            <div class="form-row">
                <label>Behaviour</label>
                <div class="settings-toggle-list">
                    <div class="settings-toggle-item" data-setting-name="action-sound" data-setting-meta="put-delete">
                        <div class="settings-toggle-copy">
                            <label class="settings-toggle-title" for="actionSoundEnabledInput">Action Sound</label>
                            <div class="settings-toggle-desc">Play <code>assets/put.mp3</code> on add and <code>assets/delete.mp3</code> on delete actions.</div>
                        </div>
                        <input type="checkbox" id="actionSoundEnabledInput" aria-label="Action sound">
                    </div>
                    <div class="settings-toggle-item">
                        <div class="settings-toggle-copy">
                            <label class="settings-toggle-title" for="audioPreloadEnabledInput">Word Preload</label>
                            <div class="settings-toggle-desc">Preload pronunciation audio before playback.</div>
                        </div>
                        <input type="checkbox" id="audioPreloadEnabledInput" aria-label="Word preload">
                    </div>
                </div>
            </div>

            <div class="form-row">
                <label>Tags</label>
                <div id="tagManagerList" class="tag-manager-list"></div>
                <div class="tag-manager-add-row">
                    <input type="text" id="tagManagerNewInput" placeholder="New tag…">
                    <button class="btn-secondary" onclick="tagManagerAdd()">Add</button>
                </div>
            </div>

            <div class="form-row danger-zone">
                <label>Danger Zone</label>
                <div class="settings-inline-actions">
                    <button class="btn-danger" onclick="clearAllData()">Clear All Data</button>
                </div>
            </div>

        </div>
        <div class="modal-actions">
            <button class="btn-primary" onclick="saveSettings()">Save</button>
            <button class="btn-secondary" onclick="cancelSettings()">Cancel</button>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal modal-confirm">
        <div class="modal-content confirm-modal-content">
            <div class="modal-header" id="confirmModalTitle">Confirm</div>
            <div id="confirmModalMessage" class="confirm-modal-message"></div>
            <div class="modal-actions">
                <button class="btn-primary" id="confirmModalConfirmBtn">Confirm</button>
                <button class="btn-secondary" id="confirmModalCancelBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- History Modal (Registry Editor Style) -->
    <div id="historyModal" class="modal modal-registry">
        <div class="registry-container">
            <!-- Toolbar -->
            <div class="registry-toolbar">
                <div class="registry-title">Version History</div>
                <div class="registry-toolbar-actions">
                    <span id="registryVersionInfo" class="registry-info"></span>
                    <button class="registry-toolbar-btn" id="registryDeleteBtn" onclick="deleteSelectedVersions()" disabled title="Delete selected">Del</button>
                    <button class="registry-toolbar-btn" id="registryRenameBtn" onclick="renameSelectedVersion()" disabled title="Rename selected">Rename</button>
                    <button class="registry-close" onclick="closeHistoryModal()" aria-label="Close">&times;</button>
                </div>
            </div>

            <!-- Address bar -->
            <div class="registry-addressbar">
                <div id="registryPath" class="registry-path"></div>
            </div>

            <!-- Main body: tree + preview -->
            <div class="registry-body">
                <!-- Left pane: tree -->
                <div class="registry-tree-pane" id="registryTreePane">
                    <div id="historyTree" class="registry-tree">
                        <!-- Dynamically generated tree -->
                    </div>
                </div>

                <!-- Divider -->
                <div class="registry-divider"></div>

                <!-- Right pane: preview -->
                <div class="registry-preview-pane" id="registryPreviewPane">
                    <!-- Mode switcher (PC only) -->
                    <div class="registry-preview-tabs" id="registryPreviewTabs">
                        <button class="registry-tab active" data-mode="version" onclick="switchPreviewMode('version')">Version</button>
                        <button class="registry-tab" data-mode="diff" onclick="switchPreviewMode('diff')">Diff</button>
                    </div>
                    <div id="registryPreview" class="registry-preview" tabindex="0">
                        <div class="registry-preview-empty">Select a version to preview</div>
                    </div>
                </div>
            </div>

            <!-- Mobile preview overlay (portrait) -->
            <div class="registry-mobile-preview" id="registryMobilePreview">
                <div class="registry-mobile-preview-header">
                    <button class="registry-back-btn" onclick="closeMobilePreview()">&lt; Back</button>
                    <span id="mobilePreviewTitle" class="registry-mobile-title"></span>
                    <button class="btn-secondary registry-goto-btn" id="mobileGotoBtn" onclick="">Go to</button>
                </div>
                <div id="mobilePreviewContent" class="registry-preview"></div>
            </div>

            <!-- Status bar -->
            <div class="registry-statusbar">
                <span id="registryStatusLeft"></span>
                <span id="registryStatusRight"></span>
            </div>
        </div>
    </div>

    <!-- Quiz Setup Modal -->
    <div id="quizSetupModal" class="modal modal-quiz">
        <div class="modal-content">
            <div class="modal-header">Quiz</div>

            <div class="form-row">
                <label>Mode</label>
                <div class="quiz-mode-options">
                    <label class="quiz-mode-option">
                        <input type="radio" name="quizMode" value="spelling" checked>
                        <span class="quiz-mode-label">Spelling</span>
                        <span class="quiz-mode-desc">See meaning → type the word</span>
                    </label>
                    <label class="quiz-mode-option">
                        <input type="radio" name="quizMode" value="mc">
                        <span class="quiz-mode-label">Multiple Choice</span>
                        <span class="quiz-mode-desc">See word → choose correct meaning</span>
                    </label>
                </div>
            </div>

            <div class="form-row">
                <label>Count</label>
                <input type="number" id="quizCountInput" class="range-input" min="1" placeholder="All">
            </div>

            <div id="quizSetupInfo" class="quiz-setup-info"></div>

            <div class="modal-actions">
                <button class="btn-primary" onclick="startQuiz()">Start</button>
                <button class="btn-secondary" onclick="closeQuizSetup()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Quiz Question Modal -->
    <div id="quizQuestionModal" class="modal modal-quiz">
        <div class="modal-content quiz-question-content">
            <div class="quiz-progress-row">
                <span id="quizProgress" class="quiz-progress-label"></span>
                <button class="quiz-abandon-btn btn-secondary" onclick="abandonQuiz()">✕</button>
            </div>

            <!-- Spelling mode -->
            <div id="quizSpellingSection">
                <div class="quiz-hint-label">What is the word?</div>
                <div class="quiz-word-line">
                    <div id="quizMeaningDisplay" class="quiz-big-text"></div>
                    <button class="btn-pronounce quiz-pronounce-btn" onclick="pronounceQuizWord()" title="Pronounce (British)" aria-label="Pronounce (British)"><svg class="icon-speaker" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path fill="currentColor" d="M3 10v4c0 1.1.9 2 2 2h2.35l3.38 2.7c.93.74 2.27.08 2.27-1.1V6.4c0-1.18-1.34-1.84-2.27-1.1L7.35 8H5c-1.1 0-2 .9-2 2Zm14.5 2c0-1.77-1.02-3.29-2.5-4.03v8.06c1.48-.74 2.5-2.26 2.5-4.03ZM15 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77Z"/></svg></button>
                </div>
                <div id="quizPosDisplay" class="quiz-pos-text"></div>
                <div class="quiz-input-row">
                    <input type="text" id="quizSpellingInput" class="quiz-spelling-input" placeholder="Type the word…" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" onkeydown="quizSpellingKeydown(event)">
                    <button class="btn-primary quiz-check-btn" onclick="checkSpelling()">Check</button>
                </div>
            </div>

            <!-- Multiple choice mode -->
            <div id="quizMCSection" style="display:none">
                <div class="quiz-hint-label">Choose the correct meaning:</div>
                <div class="quiz-word-line">
                    <div id="quizWordDisplay" class="quiz-big-text"></div>
                    <button class="btn-pronounce quiz-pronounce-btn" onclick="pronounceQuizWord()" title="Pronounce (British)" aria-label="Pronounce (British)"><svg class="icon-speaker" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path fill="currentColor" d="M3 10v4c0 1.1.9 2 2 2h2.35l3.38 2.7c.93.74 2.27.08 2.27-1.1V6.4c0-1.18-1.34-1.84-2.27-1.1L7.35 8H5c-1.1 0-2 .9-2 2Zm14.5 2c0-1.77-1.02-3.29-2.5-4.03v8.06c1.48-.74 2.5-2.26 2.5-4.03ZM15 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77Z"/></svg></button>
                </div>
                <div id="quizWordPosDisplay" class="quiz-pos-text"></div>
                <div id="quizChoices" class="quiz-choices"></div>
            </div>

            <!-- Result area -->
            <div id="quizResultArea" class="quiz-result-area" style="display:none"></div>

            <div id="quizRevealRow" style="display:none">
                <div id="quizRevealWord" class="quiz-reveal-word"></div>
            </div>

            <button id="quizNextBtn" class="btn-primary" style="display:none" onclick="nextQuizQuestion()">Next →</button>
        </div>
    </div>

    <!-- Quiz End Modal -->
    <div id="quizEndModal" class="modal modal-quiz">
        <div class="modal-content">
            <div class="modal-header">Quiz Complete</div>

            <div class="quiz-end-score" id="quizEndScore"></div>

            <div id="quizEndWrongSection" class="quiz-end-section">
                <div class="quiz-end-section-label quiz-end-label-wrong">Wrong</div>
                <div id="quizEndWrongList" class="quiz-end-word-list"></div>
                <button class="btn-secondary quiz-adjust-btn" id="quizEndAdjustWrongBtn" onclick="adjustQuizWeights(1,'wrong')">+1 weight (wrong answers)</button>
            </div>

            <div id="quizEndCorrectSection" class="quiz-end-section">
                <div class="quiz-end-section-label quiz-end-label-correct">Correct</div>
                <div id="quizEndCorrectList" class="quiz-end-word-list"></div>
                <button class="btn-secondary quiz-adjust-btn" id="quizEndAdjustCorrectBtn" onclick="adjustQuizWeights(-1,'correct')">-1 weight (correct answers)</button>
            </div>

            <div class="modal-actions">
                <button class="btn-primary" onclick="closeQuizEnd()">Done</button>
            </div>
        </div>
    </div>

    <div id="dragImportOverlay" class="drag-import-overlay" aria-hidden="true">
        <div class="drag-import-overlay-card">
            Drop JSON file to import
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
