<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯è®°å¿†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
            background: #ffffff;
            color: #1d1d1f;
            line-height: 1.6;
            padding-bottom: 60px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: center;
            letter-spacing: -0.5px;
        }

        /* æ¨¡å¼åˆ‡æ¢ */
        .mode-switch {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            padding: 16px;
            background: #f5f5f7;
            border-radius: 12px;
        }

        .mode-switch label {
            font-size: 15px;
            color: #86868b;
        }

        .toggle {
            position: relative;
            width: 51px;
            height: 31px;
            background: #e5e5ea;
            border-radius: 15.5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: #34c759;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 27px;
            height: 27px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .toggle.active .toggle-slider {
            transform: translateX(20px);
        }

        /* æ·»åŠ å•è¯è¡¨å• */
        .add-form {
            background: #f5f5f7;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .form-row {
            margin-bottom: 12px;
        }

        .form-row:last-child {
            margin-bottom: 0;
        }

        .form-row label {
            display: block;
            font-size: 13px;
            color: #86868b;
            margin-bottom: 6px;
        }

        input[type="text"], select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            background: white;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #0071e3;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        button {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 12px;
        }

        .btn-primary {
            background: #0071e3;
            color: white;
        }

        .btn-primary:active {
            background: #0077ed;
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #e5e5ea;
            color: #1d1d1f;
        }

        .btn-secondary:active {
            background: #d2d2d7;
            transform: scale(0.98);
        }

        /* æ•°æ®ç®¡ç†æŒ‰é’® */
        .data-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
        }

        .data-controls button {
            margin-top: 0;
        }

        /* å•è¯åˆ—è¡¨ */
        .word-group {
            margin-bottom: 40px;
        }

        .group-header {
            font-size: 13px;
            font-weight: 600;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e5ea;
        }

        .word-item {
            background: white;
            padding: 16px;
            margin-bottom: 1px;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .word-item:first-child {
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }

        .word-item:last-child {
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            margin-bottom: 0;
        }

        .word-item.weight-5 { border-left-color: #ff3b30; }
        .word-item.weight-4 { border-left-color: #ff9500; }
        .word-item.weight-3 { border-left-color: #ffcc00; }
        .word-item.weight-2 { border-left-color: #34c759; }
        .word-item.weight-1 { border-left-color: #007aff; }
        .word-item.weight-0 { border-left-color: #8e8e93; }

        .word-item.mastered {
            color: #86868b;
            background: #fafafa;
        }

        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .word-title {
            font-size: 18px;
            font-weight: 600;
        }

        .word-pos {
            font-size: 12px;
            color: #86868b;
            margin-left: 8px;
        }

        .word-weight {
            font-size: 13px;
            font-weight: 600;
            color: #86868b;
            min-width: 30px;
            text-align: right;
        }

        .word-meaning {
            font-size: 15px;
            color: #515154;
            margin-bottom: 12px;
        }

        .word-actions {
            display: flex;
            gap: 8px;
        }

        .word-actions button {
            flex: 1;
            padding: 8px;
            font-size: 14px;
            margin-top: 0;
        }

        .btn-remember {
            background: #34c759;
            color: white;
        }

        .btn-forget {
            background: #ff9500;
            color: white;
        }

        .btn-delete {
            background: #ff3b30;
            color: white;
            flex: 0 0 auto;
            min-width: 60px;
        }

        .btn-remember:active { background: #30b450; }
        .btn-forget:active { background: #e68a00; }
        .btn-delete:active { background: #e63529; }

        /* æŠ˜å åŒºåŸŸ */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            cursor: pointer;
            user-select: none;
        }

        .collapse-icon {
            transition: transform 0.3s;
        }

        .collapse-icon.expanded {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 5000px;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #86868b;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* éšè—æ–‡ä»¶è¾“å…¥ */
        #importFile {
            display: none;
        }

        /* å“åº”å¼ */
        @media (max-width: 600px) {
            .container {
                padding: 16px;
            }

            h1 {
                font-size: 24px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å•è¯è®°å¿†ç³»ç»Ÿ</h1>

        <!-- æ¨¡å¼åˆ‡æ¢ -->
        <div class="mode-switch">
            <label>æ—¥å¸¸æ¨¡å¼</label>
            <div class="toggle" id="modeToggle">
                <div class="toggle-slider"></div>
            </div>
            <label>å…¨é‡æ¨¡å¼</label>
        </div>

        <!-- æ·»åŠ å•è¯è¡¨å• -->
        <div class="add-form">
            <div class="form-row">
                <label>å•è¯ *</label>
                <input type="text" id="wordInput" placeholder="è¾“å…¥å•è¯" required>
            </div>
            <div class="form-row">
                <label>å«ä¹‰ *</label>
                <input type="text" id="meaningInput" placeholder="è¾“å…¥å«ä¹‰" required>
            </div>
            <div class="form-grid">
                <div class="form-row">
                    <label>è¯æ€§ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="posInput" placeholder="å¦‚ï¼šn. v. adj.">
                </div>
                <div class="form-row">
                    <label>æƒé‡ *</label>
                    <select id="weightInput">
                        <option value="5">5 - æœ€éš¾</option>
                        <option value="4">4 - è¾ƒéš¾</option>
                        <option value="3" selected>3 - éœ€ç²¾è®°ï¼ˆé»˜è®¤ï¼‰</option>
                        <option value="2">2 - ä¸€èˆ¬</option>
                        <option value="1">1 - åªéœ€çœ‹æ‡‚</option>
                        <option value="0">0 - åŸºæœ¬æŒæ¡</option>
                        <option value="-1">-1 - å®Œå…¨æŒæ¡</option>
                        <option value="-2">-2 - è¿‡äºç®€å•</option>
                    </select>
                </div>
            </div>
            <button class="btn-primary" onclick="addWord()">æ·»åŠ å•è¯</button>
        </div>

        <!-- æ•°æ®ç®¡ç† -->
        <div class="data-controls">
            <button class="btn-secondary" onclick="exportData()">å¯¼å‡ºJSON</button>
            <button class="btn-secondary" onclick="document.getElementById('importFile').click()">å¯¼å…¥JSON</button>
            <input type="file" id="importFile" accept=".json" onchange="importData(event)">
        </div>

        <!-- å•è¯åˆ—è¡¨ -->
        <div id="wordList"></div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let words = [];
        let isFullMode = false;

        // åˆå§‹åŒ–
        window.onload = function() {
            loadData();
            renderWords();
        };

        // æ¨¡å¼åˆ‡æ¢
        document.getElementById('modeToggle').addEventListener('click', function() {
            this.classList.toggle('active');
            isFullMode = !isFullMode;
            renderWords();
        });

        // æ·»åŠ å•è¯
        function addWord() {
            const word = document.getElementById('wordInput').value.trim();
            const meaning = document.getElementById('meaningInput').value.trim();
            const pos = document.getElementById('posInput').value.trim();
            const weight = parseInt(document.getElementById('weightInput').value);

            if (!word || !meaning) {
                alert('è¯·å¡«å†™å•è¯å’Œå«ä¹‰');
                return;
            }

            const newWord = {
                word: word.toLowerCase(),
                meaning: meaning,
                pos: pos,
                weight: weight,
                added: new Date().toISOString().split('T')[0]
            };

            words.push(newWord);
            saveData();
            renderWords();

            // æ¸…ç©ºè¡¨å•
            document.getElementById('wordInput').value = '';
            document.getElementById('meaningInput').value = '';
            document.getElementById('posInput').value = '';
            document.getElementById('weightInput').value = '3';
        }

        // æ›´æ–°æƒé‡
        function updateWeight(index, delta) {
            const newWeight = words[index].weight + delta;
            
            // æƒé‡é™åˆ¶åœ¨-2åˆ°10ä¹‹é—´
            if (newWeight < -2 || newWeight > 10) {
                return;
            }

            words[index].weight = newWeight;
            saveData();
            renderWords();
        }

        // åˆ é™¤å•è¯
        function deleteWord(index) {
            if (confirm(`ç¡®å®šåˆ é™¤å•è¯ "${words[index].word}" å—ï¼Ÿ`)) {
                words.splice(index, 1);
                saveData();
                renderWords();
            }
        }

        // æ¸²æŸ“å•è¯åˆ—è¡¨
        function renderWords() {
            const container = document.getElementById('wordList');
            
            // è¿‡æ»¤å•è¯
            let filteredWords = words.filter(w => {
                if (isFullMode) {
                    return w.weight >= -1; // å…¨é‡æ¨¡å¼ï¼šæ˜¾ç¤º-1åŠä»¥ä¸Š
                } else {
                    return w.weight >= 0; // æ—¥å¸¸æ¨¡å¼ï¼šåªæ˜¾ç¤ºæ­£æ•°æƒé‡
                }
            });

            if (filteredWords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“š</div>
                        <div>${isFullMode ? 'æš‚æ— å•è¯' : 'æš‚æ— éœ€è¦å¤ä¹ çš„å•è¯'}</div>
                    </div>
                `;
                return;
            }

            // æŒ‰æƒé‡åˆ†ç»„
            const groups = {};
            filteredWords.forEach(w => {
                if (!groups[w.weight]) {
                    groups[w.weight] = [];
                }
                groups[w.weight].push(w);
            });

            // å¯¹æ¯ç»„å†…çš„å•è¯æŒ‰å­—æ¯æ’åº
            Object.keys(groups).forEach(weight => {
                groups[weight].sort((a, b) => a.word.localeCompare(b.word));
            });

            // æŒ‰æƒé‡é™åºæ’åˆ—ç»„
            const sortedWeights = Object.keys(groups).map(Number).sort((a, b) => b - a);

            let html = '';
            sortedWeights.forEach(weight => {
                const groupWords = groups[weight];
                const isMastered = weight < 0;
                
                const groupLabel = weight >= 5 ? `æƒé‡ ${weight} - æœ€éš¾` :
                                  weight === 4 ? `æƒé‡ ${weight} - è¾ƒéš¾` :
                                  weight === 3 ? `æƒé‡ ${weight} - éœ€ç²¾è®°` :
                                  weight === 2 ? `æƒé‡ ${weight} - ä¸€èˆ¬` :
                                  weight === 1 ? `æƒé‡ ${weight} - åªéœ€çœ‹æ‡‚` :
                                  weight === 0 ? `æƒé‡ ${weight} - åŸºæœ¬æŒæ¡` :
                                  weight === -1 ? `æƒé‡ ${weight} - å®Œå…¨æŒæ¡` :
                                  `æƒé‡ ${weight} - è¿‡äºç®€å•`;

                if (isMastered) {
                    // å¯æŠ˜å çš„å·²æŒæ¡åŒºåŸŸ
                    html += `
                        <div class="word-group">
                            <div class="collapsible-header" onclick="toggleCollapse(this)">
                                <div class="group-header" style="margin-bottom: 0; border: none;">${groupLabel} (${groupWords.length})</div>
                                <div class="collapse-icon">â–¼</div>
                            </div>
                            <div class="collapsible-content">
                    `;
                } else {
                    html += `
                        <div class="word-group">
                            <div class="group-header">${groupLabel} (${groupWords.length})</div>
                    `;
                }

                groupWords.forEach(w => {
                    const originalIndex = words.indexOf(w);
                    const weightClass = weight >= 0 ? `weight-${Math.min(weight, 5)}` : '';
                    const masteredClass = isMastered ? 'mastered' : '';

                    html += `
                        <div class="word-item ${weightClass} ${masteredClass}">
                            <div class="word-header">
                                <div>
                                    <span class="word-title">${w.word}</span>
                                    ${w.pos ? `<span class="word-pos">${w.pos}</span>` : ''}
                                </div>
                                <div class="word-weight">${w.weight}</div>
                            </div>
                            <div class="word-meaning">${w.meaning}</div>
                            <div class="word-actions">
                                ${w.weight >= 0 ? `<button class="btn-remember" onclick="updateWeight(${originalIndex}, -1)">è®°ä½äº† â†“</button>` : ''}
                                ${w.weight >= -1 && w.weight < 10 ? `<button class="btn-forget" onclick="updateWeight(${originalIndex}, 1)">æ²¡è®°ä½ â†‘</button>` : ''}
                                <button class="btn-delete" onclick="deleteWord(${originalIndex})">åˆ é™¤</button>
                            </div>
                        </div>
                    `;
                });

                if (isMastered) {
                    html += `
                            </div>
                        </div>
                    `;
                } else {
                    html += `</div>`;
                }
            });

            container.innerHTML = html;
        }

        // æŠ˜å åˆ‡æ¢
        function toggleCollapse(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.collapse-icon');
            
            content.classList.toggle('expanded');
            icon.classList.toggle('expanded');
        }

        // æ•°æ®æŒä¹…åŒ–
        function saveData() {
            localStorage.setItem('wordMemoryData', JSON.stringify(words));
        }

        function loadData() {
            const saved = localStorage.getItem('wordMemoryData');
            if (saved) {
                words = JSON.parse(saved);
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(words, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `word-memory-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¯¼å…¥æ•°æ®
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        if (confirm(`ç¡®å®šå¯¼å…¥ ${imported.length} ä¸ªå•è¯å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®ã€‚`)) {
                            words = imported;
                            saveData();
                            renderWords();
                        }
                    } else {
                        alert('æ–‡ä»¶æ ¼å¼é”™è¯¯');
                    }
                } catch (error) {
                    alert('æ–‡ä»¶è§£æå¤±è´¥');
                }
                event.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
            };
            reader.readAsText(file);
        }

        // å›è½¦æ·»åŠ å•è¯
        document.getElementById('wordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addWord();
        });
        document.getElementById('meaningInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addWord();
        });
        document.getElementById('posInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addWord();
        });
    </script>
</body>
</html>
